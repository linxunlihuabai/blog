# TCP和UDP的区别

1. TCP是面向连接的传输层协议，UDP是面向无连接的传输层协议
2. TCP是可靠的，它保证数据的顺序和完整性，UDP不可靠，它不保证数据的顺序和完整性
3. TCP是基于字节流的，UDP是基于数据报的。

# TCP为什么是可靠的

1. 确认和重传机制（三次握手时同步了双方的序列号、确认号、和窗口信息）
2. 流量控制 （TCP窗口指明了双方能够接收的最大流量）
3. 拥塞控制 

# TCP的三次握手和四次挥手

## 三次握手

1. 客户端主动发起连接，发送自己的序列号
2. 服务端接收到客户端的序列号，返回确认和自己的序列号
3. 客户端接受到服务端的序列号，发送确认给服务端，服务端接收到确认后连接就建立了。

## 为什么要三次握手？

为了保证数据传输的可靠性，双方都需要确认对方收到了自己的序列号。

## 为什么不是两次和四次？

两次的话，服务端没法知道客户端是不是收到了自己的序列号，因为第二次的信息可能因为网络问题没有传过去；三次就能做到了，没必要四次

## 四次挥手

1. 客户端主动发起关闭连接，FIN
2. 服务端接收后返回确认 ACK，这是服务端并不会直接关闭连接。因为服务端可能还有一些数据没发完。
3. 服务端发完数据后，主动给客户端发起关闭连接 FIN
4. 客户端接收到服务端的FIN后返回ack给服务端，服务端接收到ack后关闭连接。客户端会等待2MSL的时间后再关闭连接

## 为什么要四次挥手

服务端不会再第一次收到客户端的关闭请求时就关闭连接，因为服务端可能还有一些数据没有发完。TCP时可靠的传输，所以服务端不能直接关闭，需要等待服务端的数据发完了，再由服务端主动向客户端发出关闭连接的通知。所以第二第三次不能合并。也不能删了最后一次，不然如果关闭连接的通知没有到达客户端，客户端就一直不会关闭了。

## 为什么要等待2MSL时间再关闭

有两个理由

1. 保证客户端最后发送的ACK报文能够到达服务端：如果客户端收到服务端的FIN就直接关闭的话，那么客户端的确认ACK不一定能到服务端，那么过一段时间服务端就会超时重传FIN，但是客户端已经关闭了。这时服务端无法关闭，只能白白浪费资源。 
2. 防止已失效的报文影响到新连接：如果不等待2MSL的话，直接关闭。如果还有一些数据还在网络中，新连接又是用的刚刚的端口号，这些老的数据就会造成混乱。等待2MSL是为了保证那些无用的数据消失。

